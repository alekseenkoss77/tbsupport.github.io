var __hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};(function(t){"use strict";var e,i,n,s,r,o,a,l,c,u,h;for(e=t.jQuery,n=t.pi=t.pi||{},s=n.utils,n.Checker=function(t){function e(){return l=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.statuses=["loading"],e.prototype.initialize=function(){return this.type=this.options.type,this.desc=this.nod.find(".desc"),this.deps=this.options.deps||""},e.prototype.loading=function(t){return this.activate(),t?this.nod.addClass("is-loading"):this.nod.removeClass("is-loading")},e.prototype.finished=function(t){return this.loading(!1),this.nod.addClass("is-"+t)},e.prototype.clear=function(){var t,e,i,n;for(this.deactivate(),n=this.statuses,e=0,i=n.length;i>e;e++)t=n[e],this.nod.removeClass("is-"+t);this.desc.empty()},e.prototype.text=function(t){return this.desc.html(t)},e}(n.Base),c=["passed","failed","warning"],r=function(t){return n.Checker.prototype.statuses.push(t),n.Checker.prototype[t]=function(){return this.finished(t)}},o=0,a=c.length;a>o;o++)i=c[o],r(i);return n.Socket=function(){function t(t,e){this.path=t,null==e&&(e={}),this.ports=[80,443],this.retry_count=0,this._retry=e.retry||1,this._timeout=e.timeout||3e4}return t.prototype.messages={timeout:{status:0,message:"Вышло время ожидания подключения"},error:{status:0,message:"Ошибка подключения через веб-сокеты.          Возможные причины:          <ul>          <li> - отсутствует интернет-соединение;</li>          <li> - запрещено подключение через порты 80, 443;</li>          <li> - прокси-сервер не поддерживает соединение через веб-сокеты;</li>          <li> - домены и IP адреса Teachbase не внесены в белый список файерволла/корпортивного прокси-сервера/другой блокирующей системы <br/>          (необходимо добавить домены *.teachbase.ru и/или IP адреса 54.77.210.105)</li>          </ul>"}},t.prototype.check=function(t,e){return this.resolve=t,this.reject=e,this.init()},t.prototype.init=function(t){var e,i=this;return 0===this.ports.length&&this.reject(this.messages.error),this.port=null!=t?t:this.ports.pop(),e="ws"+(443===this.port?"s":"")+"://"+this.path,this.connected=!1,this.state="connecting",this.socket=new WebSocket(e),this._add_listeners(),this._tid=after(this._timeout,function(){return i.handle_timeout()})},t.prototype.handle_close=function(){var t=this;return this._hc||(this._hc=function(e){return t.connected=!1,t.state="close",clearTimeout(t.__retry_clear_id),clearTimeout(t._tid),e.wasClean?(t.dispose(),t.init()):t._try_to_reconnect(e)})},t.prototype.handle_timeout=function(){return this.dispose(),this.init()},t.prototype.handle_open=function(){var t=this;return this._ho||(this._ho=function(){return t.state="open",t.connected=!0,clearTimeout(t._tid),t.__retry_clear_id=s.after(1e3,function(){return t.retry_count=0}),t.resolve({status:1,message:"Соединение установлено (порт "+t.port+")",version:t.port}),t.dispose()})},t.prototype._try_to_reconnect=function(){var t=this;return this.retry_count>=this._retry?(this.dispose(),this.init()):(this.retry_count+=1,this._remove_listeners(),s.after(1e3,function(){return t.init(t.port)}))},t.prototype._add_listeners=function(){return this.socket.addEventListener("open",this.handle_open()),this.socket.addEventListener("close",this.handle_close())},t.prototype._remove_listeners=function(){return this.socket.removeEventListener("open",this.handle_open()),this.socket.removeEventListener("close",this.handle_close())},t.prototype.dispose=function(){return this._remove_listeners(),this.connected&&this.socket.close(),this.connected=!1,this.socket=null},t}(),n.RtmpChecker=function(t){function e(){return u=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.messages={"rtmp.connection":{success:{message:"Подключение установлено.",status:1},error:{status:0,message:"Ошибка подключения RTMP.          Возможные причины:          <ul>          <li> - отсутствует интернет-соединение;</li>          <li> - запрещено подключение по протоколу RTMP;</li>          <li> - запрещено подключение через порт 443;</li>          <li> - домены и IP адреса Teachbase не внесены в белый список файерволла/корпортивного прокси-сервера/другой блокирующей системы <br/>          (необходимо добавить домены *.teachbase.ru и/или IP адреса 46.182.24.106, 46.182.31.47, 79.125.119.170)</li>          </ul>"}},"rtmp.disconnected":{error:{message:"Отсутствует подключение. Попробуйте еще раз.",status:0}},"rtmp.undefined":{error:{message:"Отсутствует адрес RTMP сервера. Попробуйте еще раз.",status:0}},"rtmp.ping":{success:function(t){var e;return e="Пинг (avg, min, max): "+t.avg+"s, "+t.min+"s, "+t.max+"s.",parseInt(t.avg)>1e3?{status:2,data:t,message:""+e+"<br/>Слишком большой пинг: "+t.avg+"s. Вероятна большая задержка при общении."}:{status:1,data:t,message:e}},error:{message:"Ошибка при проверке пинга. Попробуйте еще раз.",status:0}},"rtmp.bw_in":{success:function(t){var e,i;return i="Входящая скорость (avg, min, max): "+t.avg+" KB/s, "+t.min+" KB/s, "+t.max+" KB/s.",e=parseInt(t.avg),512>e?{status:2,data:t,message:""+i+"<br/>Низкая входящая скорость. Возможны обрывы при просмотре видео других участников. <br/> Рекомендуется отключить прием видеосигнала в настройках."}:{status:1,data:t,message:i}},error:{message:"Ошибка при проверке входящей скорости. Попробуйте еще раз",status:0}},"rtmp.bw_out":{success:function(t){var e,i;return i="Исходящая скорость (avg, min, max): "+t.avg+" KB/s, "+t.min+" KB/s, "+t.max+" KB/s.",e=parseInt(t.avg),512>e?{status:2,data:t,message:""+i+"<br/>Низкая исходящая скорость. Не рекомендуется включать трансляцию камеры."}:1024>e?{status:2,data:t,message:""+i+"<br/>Средняя исходящая скорость. Трансляция камеры возможна только в низком или среднем качестве."}:{status:1,data:t,message:i}},error:{message:"Ошибка при проверке исходящей скорости. Попробуйте еще раз",status:0}}},e.prototype.initialize=function(){var t=this;return this.one("as3_event",function(e){return"info"===e.data.level&&"initialized"===e.data.type?(t._initialized=!0,t.trigger("swf_initialized")):void 0}),e.__super__.initialize.apply(this,arguments)},e.prototype.check=function(t){var e=this;return new Promise(function(i,n){return e.one("as3_event",function(t){return"error"===t.data.level?n(e.prepare_error(t.data)):i(e.prepare_success(t.data))}),e.as3_call("check_"+t)})},e.prototype.prepare_error=function(t){return this.messages[t.type].error},e.prototype.prepare_success=function(t){return"function"==typeof this.messages[t.type].success?this.messages[t.type].success(t):this.messages[t.type].success},e}(n.SwfPlayer),n.CheckerController=function(t){function i(){return h=i.__super__.constructor.apply(this,arguments)}return __extends(i,t),i.prototype.initialize=function(){var t=this;return n.event.on("piecified",function(){return t._setup()})},i.prototype._setup=function(){var t;return this.rtmp=e("@rtmp").pi(),this.progress=e("@progress").pi(),this.checkers=function(){var i,n,s,r;for(s=this.nod.find(".item"),r=[],i=0,n=s.length;n>i;i++)t=s[i],r.push(e(t).pi());return r}.call(this),this.total=this.checkers.length,this.passed="",this.report={}},i.prototype.resolver=function(){var t=this;return this._resolver?this._resolver:this._resolver=function(e){return 1===e.status?t.checkers[t.current].passed():t.checkers[t.current].warning(),t.checkers[t.current].text(e.message),t.passed+=""+t.checkers[t.current].type+";",t.report[t.checkers[t.current].type]=e,s.debug(e),t.next()}},i.prototype.error_handler=function(){var t=this;return this._error_handler?this._error_handler:this._error_handler=function(e){return t.checkers[t.current].failed(),t.checkers[t.current].text(e.message),t.report[t.checkers[t.current].type]=e,s.debug(e),t.next()}},i.prototype.start=function(){var t,e,i,n;if(this.current>=0){for(n=this.checkers,e=0,i=n.length;i>e;e++)t=n[e],t.clear();this.passed="",this.progress.reset(),this.report={}}return this.current=-1,this.trigger("start"),this.next()},i.prototype.finish=function(){return this.progress.set(100),this.trigger("finish")},i.prototype.next=function(){return this.current++,this.total>this.current?(this.progress.set(0|100*((this.current+.5*Math.random())/this.total)),this.passed.match(this.checkers[this.current].deps)?(this.checkers[this.current].loading(!0),this["check_"+this.checkers[this.current].type](this.checkers[this.current].options).then(this.resolver())["catch"](this.error_handler())):(this.checkers[this.current].failed(),this.checkers[this.current].text("Пропущена"),this.next())):this.finish()},i.prototype.check_browser_version=function(){return new Promise(function(t,e){var i;if(i=""+bowser.name+" "+bowser.version,bowser.msie){if(9>bowser.version)return e({status:0,message:"Данный браузер не поддерживается",version:i});if(10>bowser.version)return e({status:2,message:"Данный браузер не поддерживает подробный сбор статистики",version:i})}else if(bowser.firefox&&10>bowser.version||bowser.chrome&&24>bowser.version||bowser.opera&&12>bowser.version||bowser.safari&&6>bowser.version)return e({status:0,message:"Данный браузер не поддерживается",version:i});return t({status:1,message:"Установленная версия: "+i})})},i.prototype.check_ws=function(){var t=this;return new Promise(function(e,i){var s;return s=new n.Socket(t.options.ws),s.check(e,i)})},i.prototype.check_fp_version=function(){var t=this;return new Promise(function(e,i){var n,s,r,o,a;a=swfobject.getFlashPlayerVersion(),s=a.major,r=a.minor,o=a.release,n=""+s+"."+r+"."+o,swfobject.hasFlashPlayerVersion(t.options.fp_version)?e({status:1,message:"Установленная версия: "+n,version:n}):i({status:0,message:"Установленная версия: "+n+". Необходимо установить версию "+t.options.fp_version+" <a href='http://get.adobe.com/ru/flashplayer/' target='_blank'>установить</a>",version:n})})},i.prototype.check_java_version=function(){var t=this;return new Promise(function(e){var i,n;return i=deployJava.getJREs(),n="Установлена версия: "+i.join("; "),deployJava.versionCheck(""+t.options.java_version+"+")?e({status:1,message:n,version:i}):(i.length?n+="<br/>":n="",n+="Для демонстрации рабочего стола необходимо установить Java RE версии "+t.options.java_version+"+ <a href='http://java.com/en/download/testjava.jsp' target='_blank'>установить</a>",e({status:2,message:n,version:i}))})},i.prototype.check_rtmp_connection=function(){var t=this;return this.rtmp._initialized?this.rtmp.check("connection"):new Promise(function(e,i){var n;return n=after(2e4,function(){return i({status:0,message:"Приложение для проверки подключения не найдено"})}),t.rtmp.on("swf_initialized",function(){return clearTimeout(n),e()})}).then(function(){return t.rtmp.check("connection")})},i.prototype.check_rtmp_ping=function(){return this.rtmp.check("latency")},i.prototype.check_rtmp_input=function(){return this.rtmp.check("inbw")},i.prototype.check_rtmp_output=function(){return this.rtmp.check("outbw")},i}(n.Base)})(this);var __hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};(function(t){"use strict";var e,i,n,s,r;return e=t.jQuery,i=t.pi=t.pi||{},n=i.utils,r=0,videojs.options.flash.swf="/flash/video-js.swf",i.HlsPlayer=function(t){function e(){return s=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.initialize=function(){return e.__super__.initialize.apply(this,arguments)},e.prototype.load=function(t,e){var i,s;if(this.clear(),this.video=document.createElement("video"),this.video.className="video-js vjs-default-skin vjs-big-play-centered",this.nod.append(this.video),i=[],s=[],videojs.Html5.canPlaySource({type:"application/vnd.apple.mpegURL"})?(i.push({src:t,type:"application/vnd.apple.mpegURL"}),s.push("html5")):(i.push({src:t,type:"video/mp4"}),s=["flash"]),!i.length)throw Error("VideoPlayerError: Source is undefined");return this.player=videojs(this.video,{preload:"none",controls:!0,width:"100%",height:"100%",techOrder:s}),e&&this.player.poster(e),this.player.on("play",n.curry(this.trigger,["state","playing"],this)),this.player.on("pause",n.curry(this.trigger,["state","paused"],this)),this.player.on("ended",n.curry(this.trigger,["state","ended"],this)),this.player.src(i)},e.prototype.clear=function(){return this.trigger("state","clear"),this.off(),null!=this.player?(this.player.trigger("dispose"),this.player.trigger=function(){},this.player.dispose()):void 0},e}(i.Base)})(this);var __hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};(function(t){"use strict";var e,i,n,s;return e=t.jQuery,i=t.pi=t.pi||{},n=i.utils,i.Progressbar=function(t){function e(){return s=e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e.prototype.set=function(t){return this.value=t,this.nod.css({width:""+t+"%"})},e.prototype.reset=function(){return this.nod.css({width:0})},e}(i.Base)})(this),$(function(){return pi.log_level="debug",pi.piecify()});